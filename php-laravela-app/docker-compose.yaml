name : "MyPHPApp"

services:
  server:
    image: 'nginx:stable-alpine'
    ports:
      - '8000:80'
    volumes:
      - ./src:/var/www/html
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
    - webapp
    - mysql
  webapp:
     build:
       context: .
       dockerfile: dockerfiles/php.dockerfile
     volumes:
       - ./src:/var/www/html:delegated
     command: >
        sh -c "chmod -R 777 /var/www/html/storage /var/www/html/bootstrap/cache &&
           php-fpm"
  mysql:
    image: 'mysql:5.7'
    env_file: ./env/mysql.env
  composer:
     build:
      context: ./dockerfiles
      dockerfile: composer.dockerfile
     volumes:
      - ./src:/var/www/html
  artisan:
   build:
       context: ./dockerfiles
       dockerfile: php.dockerfile
   volumes:
    - ./src:/var/www/html
   entrypoint: ["php","/var/www/html/artisan"]
  npm:
    image: node
    working_dir: /var/www/html
    entrypoint: ["npm"]
    volumes:
      - ./src:/var/www/html
